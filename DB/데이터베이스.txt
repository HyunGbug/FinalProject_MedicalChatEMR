-- 관리자 테이블 
CREATE TABLE Admin (
    no INT AUTO_INCREMENT PRIMARY KEY, -- 관리자의 고유 식별자입니다.
    password VARCHAR(20) NOT NULL, -- 관리자의 비밀번호입니다.
    adminEmail VARCHAR(320) UNIQUE -- 관리자의 이메일 주소입니다.
); 

-- 환자 등록 테이블
CREATE TABLE PatientRegistrations (
    no INT AUTO_INCREMENT PRIMARY KEY, -- 환자의 고유 식별자입니다.
    name VARCHAR(50), -- 환자의 이름입니다.
    securityNum CHAR(14) UNIQUE, -- 주민등록번호입니다.
    gender CHAR(1), -- 성별 ('M' 또는 'F').
    address VARCHAR(255), -- 주소입니다
    phone VARCHAR(20), -- 전화번호입니다.
    email VARCHAR(50), -- 이메일 주소입니다.
    bloodType CHAR(6), -- 혈액형입니다.
    height FLOAT, -- 키(센티미터)입니다.
    weight FLOAT, -- 체중(킬로그램)입니다.
    allergies TEXT, -- 알레르기 정보입니다.
    bloodPressure VARCHAR(10), -- 혈압
    temperature DECIMAL(4, 1), -- 체온
    smokingStatus CHAR(1) -- 흡연 여부 ('Y' 또는 'N').
);

-- 환자 내원 테이블
CREATE TABLE PatientVisits (
    visitId INT AUTO_INCREMENT PRIMARY KEY, -- 내원 기록의 고유 식별자입니다.
    visitDate DATE, -- 내원 날짜입니다.
    visitTime TIME, -- 진료 시각입니다.
    patientName VARCHAR(50), -- 환자의 이름입니다.
    securityNum VARCHAR(14), -- 환자의 주민등록번호입니다.
    visitReason TEXT, -- 내원 사유입니다.
    doctorName VARCHAR(50), -- 담당 의사의 이름입니다.
    nurseName VARCHAR(50), -- 담당 간호사의 이름입니다.
    visitHistory TEXT, -- 내원 이력입니다.
    FOREIGN KEY (securityNum) REFERENCES PatientRegistrations(securityNum) -- 외래키 관계
);

-- 의사 테이블
CREATE TABLE Doctor (
    no INT AUTO_INCREMENT PRIMARY KEY, -- 의사의 고유 식별자입니다.
    name VARCHAR(100), -- 의사의 이름입니다.
    securityNum CHAR(14) UNIQUE, -- 주민등록번호입니다.
    email VARCHAR(100) UNIQUE, -- 이메일 주소입니다.
    phone VARCHAR(20), -- 전화번호입니다.
    licenseId CHAR(8) UNIQUE, -- 고유 식별자로 사용할 8자리 ID
    password VARCHAR(15), -- (초기에는 NULL)
    position VARCHAR(20), -- 직급입니다.
    departmentId VARCHAR(10), -- 소속 진료과입니다.
    profileImage VARCHAR(255), -- 증명사진 경로입니다.
    activeStatus VARCHAR(50) NOT NULL -- 현재 활동 상태
);

-- 간호사 테이블
CREATE TABLE Nurse (
    no INT AUTO_INCREMENT PRIMARY KEY, -- 간호사의 고유 식별자 (Primary Key)
    name VARCHAR(100), -- 간호사의 이름
    securityNum CHAR(14) UNIQUE, -- 주민등록번호 (Unique Key)
    email VARCHAR(320) UNIQUE, -- 이메일 주소 (Unique Key)
    phone VARCHAR(20), -- 전화번호
    licenseId CHAR(16) UNIQUE, -- 면허 ID (Unique Key)
    password VARCHAR(100), -- 비밀번호 (암호화 저장 추천)
    position VARCHAR(50), -- 직급
    departmentId VARCHAR(10), -- 소속 진료과
    profileImage VARCHAR(255), -- 프로필 이미지 경로
    activeStatus VARCHAR(50) -- 활동 상태
);


-- 진료 기록 테이블
CREATE TABLE MedicalRecord (
    chartNum INT AUTO_INCREMENT PRIMARY KEY, -- 차트 번호
    patientId INT NOT NULL, -- 환자 ID
    docId INT NOT NULL, -- 진료 의사 ID
    symptoms TEXT, -- 증상
    surgeryStatus CHAR(1), -- 수술 여부 ('Y' 또는 'N')
    progress TEXT, -- 경과
    visitDate TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- 진료 일자
    FOREIGN KEY (patientId) REFERENCES PatientRegistrations(no) ON DELETE CASCADE,
    FOREIGN KEY (docId) REFERENCES Doctor(no) ON DELETE CASCADE
);

-- 진단 테이블
CREATE TABLE Diagnosis (
    no INT AUTO_INCREMENT PRIMARY KEY,
    chartNum INT NOT NULL, -- MedicalRecord의 차트 번호 참조
    diseaseCode VARCHAR(10), -- 질병 코드
    diseaseName VARCHAR(255), -- 질병 명칭
    FOREIGN KEY (chartNum) REFERENCES MedicalRecord(chartNum) ON DELETE CASCADE
);

-- 약품 테이블
CREATE TABLE Prescriptions (
    no INT AUTO_INCREMENT PRIMARY KEY, -- 고유 번호
    chartNum INT NOT NULL, -- MedicalRecord의 차트 번호 참조
    entpName VARCHAR(255), -- 약품 회사
    itemSeq VARCHAR(100), -- 코드
    itemName VARCHAR(100), -- 약품명
    useMethodQesitm TEXT, -- 복용방법
    FOREIGN KEY (chartNum) REFERENCES MedicalRecord(chartNum) ON DELETE CASCADE
);

-- 약물 테이블
CREATE TABLE Drugs (
    no INT AUTO_INCREMENT PRIMARY KEY,
    chartNum INT NOT NULL, -- MedicalRecord의 차트 번호 참조
    cpntCd VARCHAR(100), -- 성분 코드
    ingdNameKor VARCHAR(200), -- 성분명(한글)
    fomlNm VARCHAR(30), -- 제형명
    dosageRouteCode VARCHAR(50), -- 투여경로
    dayMaxDosgQyUnit VARCHAR(50), -- 투여 단위
    dayMaxDosgQy VARCHAR(20), -- 1일 최대 투여량
    FOREIGN KEY (chartNum) REFERENCES MedicalRecord(chartNum) ON DELETE CASCADE
);

-- 환자 의사 간호사 배정 테이블
CREATE TABLE PatientAssignment (
    no INT AUTO_INCREMENT PRIMARY KEY,
    patientId INT NOT NULL,
    doctorId INT, -- 담당 의사의 식별자입니다.
    nurseId INT, -- 담당 간호사의 식별자입니다.
    assignmentDate DATE NOT NULL, -- 담당 지정 날짜입니다.
    FOREIGN KEY (patientId) REFERENCES PatientRegistrations(no) ON DELETE CASCADE,
    FOREIGN KEY (doctorId) REFERENCES Doctor(no) ON DELETE SET NULL,
    FOREIGN KEY (nurseId) REFERENCES Nurse(no) ON DELETE SET NULL
);

-- 의사 환자 관계 테이블
CREATE TABLE PatientDoctor (
    no INT AUTO_INCREMENT PRIMARY KEY,
    patientId INT NOT NULL, -- 환자의 식별자입니다.
    doctorId INT NOT NULL, -- 담당 의사의 ID입니다.
    relationshipStartDate DATE, -- 관리 시작 날짜입니다.
    relationshipEndDate DATE, -- 관리 종료 날짜입니다.
    FOREIGN KEY (patientId) REFERENCES PatientRegistrations(no) ON DELETE CASCADE,
    FOREIGN KEY (doctorId) REFERENCES Doctor(no) ON DELETE CASCADE
);

-- 간호사 환자 관계 테이블
CREATE TABLE PatientNurse (
    no INT AUTO_INCREMENT PRIMARY KEY,
    patientId INT NOT NULL, -- 환자의 식별자입니다.
    nurseId INT NOT NULL, -- 담당 간호사의 ID입니다.
    relationshipStartDate DATE, -- 관리 시작 날짜입니다.
    relationshipEndDate DATE, -- 관리 종료 날짜입니다.
    FOREIGN KEY (patientId) REFERENCES PatientRegistrations(no) ON DELETE CASCADE,
    FOREIGN KEY (nurseId) REFERENCES Nurse(no) ON DELETE CASCADE
);



-- 다이콤 데이터베이스
CREATE TABLE dicom_files (
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    file_name VARCHAR(255) NOT NULL,
    file_data LONGBLOB,
    STUDYKEY BIGINT ,
    STUDYINSUID VARCHAR(64) NOT NULL,
    PATKEY VARCHAR(64),
    ACCESSNUM VARCHAR(64),
    STUDYDATE VARCHAR(16),
    STUDYTIME VARCHAR(14),
    STUDYID VARCHAR(64),
    EXAMCODE VARCHAR(64),
    STUDYDESC TEXT,
    MODALITY VARCHAR(16),
    BODYPART TEXT,
    PATIENTKEY BIGINT,
    PID VARCHAR(64),
    PNAME VARCHAR(64),
    PLASTNAME VARCHAR(64),
    PFIRSTNAME VARCHAR(64),
    PKNAME VARCHAR(64),
    PENAME VARCHAR(64),
    PSEX VARCHAR(16),
    PBIRTHDATETIME VARCHAR(16),
    PATAGE VARCHAR(16),
    EXAMSTATUS BIGINT,
    REPORTSTATUS BIGINT,
    SERIESCNT BIGINT,
    SERIESMOVIECNT BIGINT,
    IMAGECNT BIGINT,
    MOVIECNT BIGINT,
    NONSERIESCOUNT BIGINT,
    NONIMAGECOUNT BIGINT,
    VERIFYFLAG BIGINT,
    VERIFYDATETIME VARCHAR(14),
    DEPT VARCHAR(64),
    REFPHYSICIANNAME VARCHAR(64),
    REQPHYSICIANNAME VARCHAR(64),
    PERFPHYSICIANNAME VARCHAR(64),
    OPERATORSNAME VARCHAR(64),
    REFERTODRID VARCHAR(64),
    REFERTODRNAME VARCHAR(64),
    PATKIND CHAR(1),
    WARD VARCHAR(64),
    SICKNAME TEXT,
    ADDEDINFO TEXT,
    HISCOMMENTS TEXT,
    HISADDEDINFO1 TEXT,
    HISADDEDINFO2 TEXT,
    HISADDEDINFO3 TEXT,
    INSNAME VARCHAR(64),
    STATIONNAME VARCHAR(64),
    CONFIRMDATETIME VARCHAR(16),
    READINGDATETIME VARCHAR(16),
    TRANSCRIBEDDATETIME VARCHAR(16),
    READTYPE BIGINT,
    READCODE VARCHAR(64),
    READCODEDESC TEXT,
    READINGDR VARCHAR(64),
    CONFIRMDR VARCHAR(64),
    TRANSCRIPTIONIST VARCHAR(64),
    READINGKEYWORD TEXT,
    TEACHINGCASED BIGINT,
    STEREOCOUNT BIGINT,
    PROTOCOLNAME TEXT,
    VIEWPOSITION TEXT,
    LATERALITY TEXT,
    REASON4STUDY TEXT,
    COMMENTS TEXT,
    STUDYTYPE VARCHAR(64),
    ARCHSTATUS BIGINT,
    COMPSTATUS BIGINT,
    DELFLAG BIGINT,
    BACKUPSTATUS BIGINT,
    BACKUPLABEL VARCHAR(64),
    BACKUPDATETIME VARCHAR(16),
    MISMATCHFLAG BIGINT,
    READINGPRIORITY BIGINT,
    ABNORMALPATIENT BIGINT,
    INSERTDATE VARCHAR(8),
    INSERTTIME VARCHAR(8),
    HOSPITALID BIGINT,
    BURNCNT BIGINT,
    BURNDATETIME VARCHAR(16),
    VALIDATEFLAG BIGINT,
    REQREADSTATUS BIGINT,
    TBFLAG BIGINT,
    MOVIEFLAG BIGINT,
    OTHERSCPSENDSTATUS BIGINT,
    STATIONFILMROOM VARCHAR(64),
    RESERVED1 TEXT,
    RESERVED2 TEXT,
    RESERVED3 TEXT,
    RESERVED4 TEXT,
    RESERVED5 TEXT,
    RESERVED6 TEXT,
    RESERVED7 TEXT,
    RESERVED8 TEXT,
    RESERVED9 TEXT,
    RESERVED10 TEXT,
    AETITLE VARCHAR(64),
    OPENSTATUS BIGINT,
    DAP FLOAT,
    FILESIZE BIGINT,
    INSERTED VARCHAR(14),
    UPDATED VARCHAR(14),
    REMOTE_FLAG BIGINT,
    AI_COMPANY VARCHAR(64),
    AI_MODEL_NAME VARCHAR(64),
    AI_UPDATED VARCHAR(14),
    AI_SCORE FLOAT,
    AI_PRIORITY BIGINT,
    AI_NUMBER_OF_FINDINGS BIGINT,
    AI_ABNORMAL_YN VARCHAR(1),
    AI_FINDING VARCHAR(64),
    AI_REPORT TEXT,
    AI_VERSION VARCHAR(16),
    AI_RESULT_CODE BIGINT,
    ACCESS_NUM TEXT,
    ADDED_INFO TEXT,
    AE_TITLE TEXT,
    BACKUP_DATE_TIME TEXT,
    BODY_PART TEXT,
    BURN_DATE_TIME TEXT,
    CONFIRM_DATE_TIME TEXT,
    CONFIRM_DR TEXT,
    EXAM_CODE TEXT,
    HIS_ADDED_INFO1 TEXT,
    HIS_ADDED_INFO2 TEXT,
    HIS_ADDED_INFO3 TEXT,
    HIS_COMMENTS TEXT,
    INS_NAME TEXT,
    INSERT_DATE TEXT,
    INSERT_TIME TEXT,
    OPERATORS_NAME TEXT,
    PAT_AGE TEXT,
    PAT_KEY TEXT,
    PBIRTH_DATE_TIME TEXT,
    PERF_PHYSICIAN_NAME TEXT,
    PFIRST_NAME TEXT,
    PK_NAME TEXT,
    PLAST_NAME TEXT,
    PROTOCOL_NAME TEXT,
    READ_CODE TEXT,
    READ_CODE_DESC TEXT,
    READING_DATE_TIME TEXT,
    READING_DR TEXT,
    READING_KEYWORD TEXT,
    REASON_FOR_STUDY TEXT,
    REF_PHYSICIAN_NAME TEXT,
    REFER_TO_DR_NAME TEXT,
    REFER_TO_DRID TEXT,
    REQ_PHYSICIAN_NAME TEXT,
    SICK_NAME TEXT,
    STATION_FILM_ROOM TEXT,
    STATION_NAME TEXT,
    STUDY_DATE TEXT,
    STUDY_DESC TEXT,
    STUDY_ID TEXT,
    STUDY_INS_UID TEXT,
    STUDY_TIME TEXT,
    STUDY_TYPE TEXT,
    TRANSCRIBED_DATE_TIME TEXT,
    VERIFY_DATE_TIME TEXT,
    VIEW_POSITION TEXT,
    ABNORMAL_PATIENT BIGINT,
    ARCH_STATUS BIGINT,
    BACKUP_STATUS BIGINT,
    BURN_CNT BIGINT,
    COMP_STATUS BIGINT,
    DEL_FLAG BIGINT,
    EXAM_STATUS BIGINT,
    FILE_SIZE BIGINT,
    HOSPITAL_ID BIGINT,
    IMAGE_CNT BIGINT,
    MISMATCH_FLAG BIGINT,
    MOVIE_CNT BIGINT,
    MOVIE_FLAG BIGINT,
    NON_IMAGE_COUNT BIGINT,
    NON_SERIES_COUNT BIGINT,
    OPEN_STATUS BIGINT,
    OTHER_SCP_SEND_STATUS BIGINT,
    PAT_KIND CHAR(1),
    PATIENT_KEY BIGINT,
    READ_TYPE BIGINT,
    READING_PRIORITY BIGINT,
    REPORT_STATUS BIGINT,
    REQ_READ_STATUS BIGINT,
    SERIES_CNT BIGINT,
    SERIES_MOVIE_CNT BIGINT,
    STEREO_COUNT BIGINT,
    TB_FLAG BIGINT,
    TEACHING_CASED BIGINT,
    VALIDATE_FLAG BIGINT,
    VERIFY_FLAG BIGINT,
    AIABNORMALYN TEXT,
    AICOMPANY TEXT,
    AIFINDING TEXT,
    AIMODELNAME TEXT,
    AINUMBEROFFINDINGS BIGINT,
    AIPRIORITY BIGINT,
    AIREPORT TEXT,
    AIRESULTCODE BIGINT,
    AISCORE FLOAT,
    AIUPDATED TEXT,
    AIVERSION TEXT,
    REASONFORSTUDY TEXT,
    REMOTEFLAG BIGINT,
    TRANSCRIBEDDATE_TIME TEXT,
    STORAGECOMPLETION VARCHAR(1)
);
